vassal_decisions = {
	form_high_kingdom_for_vassal = {
		from_potential = {
			tier = EMPEROR
		}
		potential = {
			is_ruler = yes
			is_landed = yes
			prisoner = no
			is_liege = FROM
			# Any vassal which controls more than one de-jure kingdom in the empire
			# of their primary title
			primary_title = {
				empire = {
					any_direct_de_jure_vassal_title = {
						count = 2
						# Would prefer to check if title is inactive too, but you can't
						# pass a reference to is_title_active
						#is_title_active = THIS
						is_titular = no
						ROOT = {
							completely_controls = PREV
						}
					}
				}
			}
		}
		allow = {
			# All titles in the empire of the primary title
			# are completely controlled
			primary_title = {
				empire = {
					# Double negation from de-morgan's law to allow a check for ALL
					NOT = {
						any_direct_de_jure_vassal_title = {
							ROOT = {
								NOT = { completely_controls = PREV }
							}
						}
					}
				}
			}
			# Forbid if you hold any Kingdoms outside the Empire of your primary
			# title, this is a work-around for not being able to find the newly
			# created title any other way than looking at held Kingdoms.
			primary_title = {
				empire = {
					ROOT = {
						NOT = {
							any_demesne_title = {
								tier = KING
								NOT = { de_jure_liege = PREVPREV }
							}
						}
					}
				}
			}
		}
		effect = {
			primary_title = {
				empire = {
					hidden_tooltip = {
						# Create new Kingdom title based on the Empire
						create_title = {
							tier = KING
							landless = no
							temporary = no
							custom_created = yes
							culture = ROOT
							holder = ROOT
							base_title = THIS
							copy_title_laws = yes
							make_primary_title = yes
						}
						# Destroy old Kingdoms
						any_direct_de_jure_vassal_title = {
							destroy_landed_title = THIS
							# Would prefer to deactivate title, but it can't take a reference
							#activate_title = { title = THIS status = no }
						}
					}
					# Make high kingdom de-jure the empire it is named from
					ROOT = {
						# Best effort to locate newly created title, will cause other
						# Kingdoms held by vassal to also become de-jure part of Empire.
						any_demesne_title = {
							limit = {
								tier = KING
							}
							hidden_tooltip = {
								# Set de-jure Empire of High Kingdom to Empire
								# PREVPREV = empire
								de_jure_liege = PREVPREV
							}
						}
					}
					# Make Dukes of Empire vassals of High Kingdom
					ROOT = {
						# Best effort to locate newly created title, will cause other
						# Kingdoms held by vassal to also become de-jure part of Empire.
						any_demesne_title = {
							limit = {
								tier = KING
							}
							empire = {
								# Must scope with to layers of any_direct_de_jure_vassal_title
								# rather than any_de_jure_vassal_title with a limit, or it
								# ignores titles that aren't currently held
								any_direct_de_jure_vassal_title = {
									any_direct_de_jure_vassal_title = {
										de_jure_liege = PREVPREVPREV
									}
								}
							}
						}
					}
				}
			}
		}
	}
}

decisions = {
	# Make a high kingdom out of the Empire your primary title is in
	form_high_kingdom_as_king = {
		potential = {
			is_ruler = yes
			is_landed = yes
			is_independent = yes
			tier = KING
			# Any vassal which controls more than one de-jure kingdom in the empire
			# of their primary title
			primary_title = {
				empire = {
					any_direct_de_jure_vassal_title = {
						count = 2
						# Would prefer to check if title is inactive too, but you can't
						# pass a reference to is_title_active
						#is_title_active = THIS
						is_titular = no
						ROOT = {
							completely_controls = PREV
						}
					}
				}
			}
		}
		allow = {
			# All titles in the empire of the primary title
			# are completely controlled
			primary_title = {
				empire = {
					# Double negation from de-morgan's law to allow a check for ALL
					NOT = {
						any_direct_de_jure_vassal_title = {
							ROOT = {
								NOT = { completely_controls = PREV }
							}
						}
					}
				}
			}
			# Forbid if you hold any Kingdoms outside the Empire of your primary
			# title, this is a work-around for not being able to find the newly
			# created title any other way than looking at held Kingdoms.
			primary_title = {
				empire = {
					ROOT = {
						NOT = {
							any_demesne_title = {
								tier = KING
								NOT = { de_jure_liege = PREVPREV }
							}
						}
					}
				}
			}
		}
		effect = {
			primary_title = {
				empire = {
					hidden_tooltip = {
						# Create new Kingdom title based on the Empire
						create_title = {
							tier = KING
							landless = no
							temporary = no
							custom_created = yes
							culture = ROOT
							holder = ROOT
							base_title = THIS
							copy_title_laws = yes
							make_primary_title = yes
						}
						# Destroy old Kingdoms
						any_direct_de_jure_vassal_title = {
							destroy_landed_title = THIS
							# Would prefer to deactivate title, but it can't take a reference
							#activate_title = { title = THIS status = no }
						}
					}
					# Make high kingdom de-jure the empire it is named from
					ROOT = {
						# Best effort to locate newly created title, will cause other
						# Kingdoms held by vassal to also become de-jure part of Empire.
						any_demesne_title = {
							limit = {
								tier = KING
							}
							hidden_tooltip = {
								# Set de-jure Empire of High Kingdom to Empire
								# PREVPREV = empire
								de_jure_liege = PREVPREV
							}
						}
					}
					# Make Dukes of Empire vassals of High Kingdom
					ROOT = {
						# Best effort to locate newly created title, will cause other
						# Kingdoms held by vassal to also become de-jure part of Empire.
						any_demesne_title = {
							limit = {
								tier = KING
							}
							empire = {
								# Must scope with to layers of any_direct_de_jure_vassal_title
								# rather than any_de_jure_vassal_title with a limit, or it
								# ignores titles that aren't currently held
								any_direct_de_jure_vassal_title = {
									any_direct_de_jure_vassal_title = {
										de_jure_liege = PREVPREVPREV
									}
								}
							}
						}
					}
				}
			}
		}
	}

	# Make a high kingdom out of the Empire your primary title is
	form_high_kingdom_as_emperor = {
		potential = {
			is_ruler = yes
			is_landed = yes
			is_independent = yes
			tier = EMPEROR
			# Any vassal which controls more than one de-jure kingdom in the empire
			# of their primary title
			primary_title = {
				any_direct_de_jure_vassal_title = {
					count = 2
					# Would prefer to check if title is inactive too, but you can't
					# pass a reference to is_title_active
					#is_title_active = THIS
					is_titular = no
					ROOT = {
						completely_controls = PREV
					}
				}
			}
		}
		allow = {
			# All titles in the empire of the primary title
			# are completely controlled
			primary_title = {
				# Double negation from de-morgan's law to allow a check for ALL
				NOT = {
					any_direct_de_jure_vassal_title = {
						ROOT = {
							NOT = { completely_controls = PREV }
						}
					}
				}
			}
			# Forbid if you hold any Kingdoms outside the Empire of your primary
			# title, this is a work-around for not being able to find the newly
			# created title any other way than looking at held Kingdoms.
			primary_title = {
				ROOT = {
					NOT = {
						any_demesne_title = {
							tier = KING
							NOT = { de_jure_liege = PREVPREV }
						}
					}
				}
			}
		}
		effect = {
			primary_title = {
				hidden_tooltip = {
					# Create new Kingdom title based on the Empire
					create_title = {
						tier = KING
						landless = no
						temporary = no
						custom_created = yes
						culture = ROOT
						holder = ROOT
						base_title = THIS
						copy_title_laws = yes
						make_primary_title = yes
					}
					# Destroy old Kingdoms
					any_direct_de_jure_vassal_title = {
						destroy_landed_title = THIS
						# Would prefer to deactivate title, but it can't take a reference
						#activate_title = { title = THIS status = no }
					}
				}
				# Make high kingdom de-jure the empire it is named from
				ROOT = {
					# Best effort to locate newly created title, will cause other
					# Kingdoms held by vassal to also become de-jure part of Empire.
					any_demesne_title = {
						limit = {
							tier = KING
						}
						hidden_tooltip = {
							# Set de-jure Empire of High Kingdom to Empire
							# PREVPREV = empire
							de_jure_liege = PREVPREV
						}
					}
				}
				# Make Dukes of Empire vassals of High Kingdom
				ROOT = {
					# Best effort to locate newly created title, will cause other
					# Kingdoms held by vassal to also become de-jure part of Empire.
					any_demesne_title = {
						limit = {
							tier = KING
						}
						empire = {
							# Must scope with to layers of any_direct_de_jure_vassal_title
							# rather than any_de_jure_vassal_title with a limit, or it
							# ignores titles that aren't currently held
							any_direct_de_jure_vassal_title = {
								any_direct_de_jure_vassal_title = {
									de_jure_liege = PREVPREVPREV
								}
							}
						}
					}
				}
			}
		}
	}
}
